[unix_http_server]
file=/wg-auto/wg-auto/.run/supervisor.sock
chmod=770
chown=wg-auto:www-data

[supervisord]
logfile=/wg-auto/wg-auto/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=5
loglevel=info
pidfile=/wg-auto/wg-auto/.run/supervisord.pid
nodaemon=false
user=wg-auto
minfds=1024
minprocs=200

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///wg-auto/wg-auto/.run/supervisor.sock

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Gunicorn (FINAL FIX)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[program:wg-auto-gunicorn]
directory=/wg-auto/wg-auto
command=/wg-auto/wg-auto/venv/bin/gunicorn config.wsgi:application --workers 3 --bind unix:/wg-auto/wg-auto/.run/wg-auto.sock --timeout 120
user=wg-auto
autostart=true
autorestart=true
startsecs=5
stopsignal=TERM
killasgroup=true
stopasgroup=true
stdout_logfile=/wg-auto/wg-auto/logs/gunicorn.log
stderr_logfile=/wg-auto/wg-auto/logs/gunicorn.err
environment=PATH="/wg-auto/wg-auto/venv/bin",VIRTUAL_ENV="/wg-auto/wg-auto/venv",DJANGO_SETTINGS_MODULE="config.settings",PYTHONUNBUFFERED="1"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Celery Worker
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[program:wg-auto-celery]
directory=/wg-auto/wg-auto
command=/wg-auto/wg-auto/venv/bin/celery -A config worker -l INFO
user=wg-auto
autostart=true
autorestart=true
stdout_logfile=/wg-auto/wg-auto/logs/celery-worker.log
stderr_logfile=/wg-auto/wg-auto/logs/celery-worker.err
stopsignal=TERM
environment=PATH="/wg-auto/wg-auto/venv/bin",VIRTUAL_ENV="/wg-auto/wg-auto/venv",DJANGO_SETTINGS_MODULE="config.settings",PYTHONUNBUFFERED="1"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Celery Beat (FINAL â€“ VERIFIED)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[program:wg-auto-celery-beat]
directory=/wg-auto/wg-auto
command=/wg-auto/wg-auto/venv/bin/celery -A config beat --loglevel=INFO --scheduler django_celery_beat.schedulers:DatabaseScheduler
user=wg-auto
autostart=true
autorestart=true
startsecs=5
stopwaitsecs=600
killasgroup=true
stopasgroup=true
stdout_logfile=/wg-auto/wg-auto/logs/celery-beat.log
stderr_logfile=/wg-auto/wg-auto/logs/celery-beat.err
environment=PATH="/wg-auto/wg-auto/venv/bin",VIRTUAL_ENV="/wg-auto/wg-auto/venv",DJANGO_SETTINGS_MODULE="config.settings",PYTHONPATH="/wg-auto/wg-auto",PYTHONUNBUFFERED="1"
